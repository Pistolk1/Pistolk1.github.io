<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terminal Adventure</title>
  <style>
    body {
      font-family: "Courier New", Courier, monospace;
      background-color: #000;
      color: #0f0;
      height: 100vh;
      display: flex;
      flex-direction: row;
      overflow: hidden;
    }
    #terminal {
      flex-grow: 1;
      padding: 20px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    #input-container {
      width: 300px;
      background-color: #111;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }
    #input-line {
      display: flex;
      align-items: center;
      margin-top: auto;
    }
    #input {
      background: none;
      color: #0f0;
      border: none;
      outline: none;
      flex-grow: 1;
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <div id="terminal">
    <div>Welcome to the ASCII Terminal Adventure Game!</div>
    <div>Type <strong>*start</strong> to generate a new adventure.</div>
    <div>Type <strong>*help</strong> for commands.</div>
    <br>
  </div>
  <div id="input-container">
    <div id="input-line">
      <span>&gt; </span><input id="input" type="text" autofocus>
    </div>
  </div>

  <script>
    const terminal = document.getElementById("terminal");
    const input = document.getElementById("input");

    const assets = {
      backgrounds: {
        forest: `
        ðŸŒ²ðŸŒ²ðŸŒ²ðŸŒ²ðŸŒ²ðŸŒ²ðŸŒ²
        ðŸŒ²         ðŸŒ²
        ðŸŒ²   ðŸŒ™     ðŸŒ²
        ðŸŒ²         ðŸŒ²
        ðŸŒ²ðŸŒ²ðŸŒ²ðŸŒ²ðŸŒ²ðŸŒ²ðŸŒ²`,
        cave: `
        ðŸ•³ï¸ðŸ•³ï¸ðŸ•³ï¸ðŸ•³ï¸ðŸ•³ï¸
        ðŸ•¯ï¸     ðŸ•¯ï¸
         ðŸ•³ï¸  YOU ðŸ•³ï¸
        ðŸ•³ï¸ðŸ•³ï¸ðŸ•³ï¸ðŸ•³ï¸ðŸ•³ï¸`,
        lake: `
        ~~~~~~~~~~~~
        ~     ðŸ’§    ~
        ~~~   â›²   ~~~
        ~~~~~~~~~~~~`,
      },
      characters: {
        dragon: `
           ðŸ‰      
        ~~~~ðŸ”¥ðŸ”¥~~~~
          ~  ðŸ‘ï¸ðŸ‘ï¸  ~
          \\\\____//`,
        goblin: `
         ðŸ‘¹  
        ~~~~~
        ðŸ‘€ðŸ‘ƒðŸ‘€
         ðŸ¦·ðŸ¦· `,
        merchant: `
         ðŸ§™â€â™‚ï¸   
        ~~~~~
        ðŸ‘ï¸ ðŸ‘ï¸
         ðŸ’¼`,
      },
      items: {
        chest: `
        ðŸ’°ðŸ’°ðŸ’°
        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
        â–ˆâ–ˆâ–ˆâ–ˆ `,
        sword: `
         ðŸ—¡ï¸
         â•‘ 
         â•‘`,
        potion: `
        ðŸ§ª
        ðŸ”®`,
      }
    };

    let gameData = null;
    let currentScene = null;

    function appendToTerminal(text) {
      terminal.innerHTML += text + "\n";
      terminal.scrollTop = terminal.scrollHeight; // Scroll to the bottom
    }

    function layerAssets(layers) {
      const maxRows = Math.max(...layers.map(layer => layer.split("\n").length));
      const splitLayers = layers.map(layer => layer.split("\n"));
      let combined = "";

      for (let i = 0; i < maxRows; i++) {
        let row = "";
        for (const layer of splitLayers) {
          row += (layer[i] || "").padEnd(15, " ");
        }
        combined += row.trimEnd() + "\n";
      }
      return combined;
    }

    function generateAdventure() {
      const startLocation = "forest";
      const mainCreature = "dragon";
      const questItem = "chest";

      return {
        start: {
          text: "You wake up in a dense forest. What will you do?",
          art: layerAssets([assets.backgrounds[startLocation]]),
          choices: [
            { action: "Explore deeper into the forest", next: "explore" },
            { action: "Rest under a tree", next: "rest" }
          ]
        },
        explore: {
          text: "You encounter a fierce dragon guarding a treasure chest!",
          art: layerAssets([
            assets.backgrounds[startLocation],
            assets.characters[mainCreature],
            assets.items[questItem]
          ]),
          choices: [
            { action: "Fight the dragon", next: "fight_dragon" },
            { action: "Run away", next: "start" }
          ]
        },
        rest: {
          text: "You rest and recover your strength. Nothing happens.",
          art: layerAssets([assets.backgrounds[startLocation]]),
          choices: [
            { action: "Get up and explore", next: "explore" }
          ]
        },
        fight_dragon: {
          text: "You fight bravely but are defeated. The dragon roars triumphantly.",
          art: layerAssets([
            assets.backgrounds[startLocation],
            assets.characters[mainCreature]
          ]),
          choices: []
        }
      };
    }

    function loadScene(sceneKey) {
      const scene = gameData[sceneKey];
      if (!scene) {
        appendToTerminal("Error: Scene not found!");
        return;
      }
      currentScene = sceneKey;
      appendToTerminal(scene.art || "");
      appendToTerminal(scene.text);
      if (scene.choices && scene.choices.length > 0) {
        appendToTerminal("\nWhat will you do?");
        scene.choices.forEach((choice, index) => {
          appendToTerminal(`${index + 1}. ${choice.action}`);
        });
      }
    }

    function handleCommand(command) {
      if (command.startsWith("*")) {
        const cmd = command.slice(1).trim();
        if (cmd === "help") {
          appendToTerminal("Commands: *start, *help");
        } else if (cmd === "start") {
          gameData = generateAdventure();
          loadScene("start");
        } else {
          appendToTerminal("Unknown command. Type *help for available commands.");
        }
      } else {
        const choiceIndex = parseInt(command) - 1;
        const scene = gameData[currentScene];
        if (scene && scene.choices && scene.choices[choiceIndex]) {
          loadScene(scene.choices[choiceIndex].next);
        } else {
          appendToTerminal("Invalid choice. Try again.");
        }
      }
    }

    input.addEventListener("keypress", (event) => {
      if (event.key === "Enter") {
        const command = input.value.trim();
        input.value = "";
        appendToTerminal("> " + command);
        handleCommand(command);
      }
    });

    window.onload = () => input.focus();
  </script>
</body>
</html>
